<!DOCTYPE HTML>
<html>
<head>
<title>快递员注册</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
<link rel="stylesheet" href="css/register-wap.css" />
<script type="text/javascript" src="js/jquery-3.1.0.min.js"></script>
<link rel="stylesheet"
	href="http://cache.amap.com/lbs/static/main1119.css" />
<script type="text/javascript"
	src="http://webapi.amap.com/maps?v=1.3&key=518d06c12c5a1b59d234fa63325ceef5&plugin=AMap.CitySearch"></script>
<script type="text/javascript"
	src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
</head>
<body>
	<nav>注册帐号</nav>
	<form action="#" id="register_form" autocomplete="off" method="post">
		<!-- 手机注册开始 -->
		<div id="error_display"
			style="text-align: center; color: red; display: none;">
			<!--错误信息显示区域-->
		</div>
		<section class="phone-register">

			<div class="register-item">
				<div class="inputs ">
					<label for="phone"><img src="img/user.png"></label> <input
						type="text" class="form-control deliverName" value="点击输入真实姓名"
						onfocus="if(value==&#39;点击输入真实姓名&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;点击输入真实姓名&#39;}"
						data-role="none">
				</div>
				<div class="tip">请输入真实姓名</div>
			</div>
			<div class="register-item">
				<div class="inputs ">
					<label for="phone"><img src="img/phone.png"></label> <input
						type="text" class="form-control deliverTel" value="点击输入注册手机号"
						onfocus="if(value==&#39;点击输入注册手机号&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;点击输入注册手机号&#39;}"
						data-role="none">
				</div>
				<div class="tip">请输入合法的手机号码</div>
			</div>
			<div class="register-item">
				<div class="inputs ">
					<label for="phone"><img src="img/lock.png"></label> <input
						type="text" class="form-control deliverPwd_0" value="点击输入登录密码"
						onfocus="if(value==&#39;点击输入登录密码&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;点击输入登录密码&#39;}"
						data-role="none">
				</div>
				<div class="tip">密码只允许6位数字</div>
			</div>
			<div class="register-item">
				<div class="inputs ">
					<label for="phone"><img src="img/lock.png"></label> <input
						type="text" class="form-control deliverPwd_1" value="点击再次输入密码"
						onfocus="if(value==&#39;点击再次输入密码&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;点击再次输入密码&#39;}"
						data-role="none">
				</div>
				<div class="tip">两次输入的密码不一致</div>
			</div>
			<div class="register-item">
				<div class="inputs ">
					<label for="phone"><img src="img/id.png"></label> <input
						type="text" class="form-control deliverID" value="点击输入身份证号"
						onfocus="if(value==&#39;点击输入身份证号&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;点击输入身份证号&#39;}"
						data-role="none">
				</div>
				<div class="tip">请输入合法的身份证号</div>
			</div>
			<div class="register-item">
				<div class="inputs ">
					<label for="phone"><img src="img/dec.png"></label> <input
						type="text" class="form-control deliverCompany" value="点击选择快递公司"
						onfocus="if(value==&#39;点击选择快递公司&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;点击选择快递公司&#39;}"
						data-role="none">
				</div>
				<div class="tip">请选择快递公司</div>
			</div>
			<div class="register-item ">
				<div class="inputs verifycode-inputs">
					<label for="phone_vcode"><img src="img/addr.png"></label> <input
						type="text" class="form-control location" readonly="true"
						value="定位" onfocus="if(value==&#39;定位&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;定位&#39;}"
						data-role="none"> <span id="getcode"><a
						href="javascript:void(0);" onclick="return false;"
						class="getcode sureLoc"> 定 位 </a></span>
				</div>
				<div class="tip">定位</div>
			</div>
			<div class="register-item">
				<div class="inputs ">
					<label for="phone"><img src="img/addr.png"></label> <input
						type="text" class="form-control deliverAddr" value="请选择所在地区"
						onfocus="if(value==&#39;请选择所在地区&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;请选择所在地区&#39;}"
						data-role="none">
				</div>
				<div class="tip">请选择所在地区</div>
			</div>
			<div class="register-item">
				<div class="inputs ">
					<label for="phone"><img src="img/box.png"></label> <input
						type="text" class="form-control deviceID" value="点击输入箱柜设备号"
						onfocus="if(value==&#39;点击输入箱柜设备号&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;点击输入箱柜设备号&#39;}"
						data-role="none">
				</div>
				<div class="tip">点击输入箱柜设备号</div>
			</div>

			<div class="register-item ">
				<div class="inputs verifycode-inputs">
					<label for="phone_vcode"><img src="img/lock.png"></label> <input
						type="text" class="form-control checkCode" value="点击输入验证码"
						onfocus="if(value==&#39;点击输入验证码&#39;) {value=&#39;&#39;}"
						onblur="if (value==&#39;&#39;) {value=&#39;点击输入验证码&#39;}"
						data-role="none"> <span id="getcode"><a
						href="javascript:void(0);" onclick="get_phone_code(this)"
						class="getcode">获取验证码</a></span>
				</div>
				<div class="tip">验证码格式有误.</div>
			</div>

			<div class="register-item ">
				<select name="drop1" class="inputs group">

				</select>
			</div>
		</section>
		<!-- 注册按键 -->
		<section class="register-btn">
			<button type="button" id="submit" onClick="wapChkRegister()">提
				交</button>
		</section>
	</form>
	<script type="text/javascript">
	
	$(function() {
		var url = "group.do";
		$.getJSON(url, function(result) {
			var list = result.data;
			for(var i=0; i<list.length; i++) {
				var option = "<option id='"+list[i].fi_ID+"'>"+list[i].fs_Name+"</option>";
				$(".group").append(option);
			}
		});
	});

	function wapChkRegister() {
		var deliverName = $('.deliverName').val();
		if("点击输入真实姓名" == deliverName || !/^([\u4E00-\uFA29]|[\uE7C7-\uE7F3])*$/.test(deliverName)) {
			$('.deliverName').parent().siblings().css('visibility','visible');
			return;
		} else {
			$('.deliverName').parent().siblings().css('visibility','hidden');
		}
		var deliverTel = $('.deliverTel').val();
		if(!/^1[3|4|5|8|7][0-9]\d{8}$/.test(deliverTel)) {
			$('.deliverTel').parent().siblings().css('visibility','visible');
			return;
		} else {
			$('.deliverTel').parent().siblings().css('visibility','hidden');
		}
		var pwd_0 = $('.deliverPwd_0').val();
		var pwd_1 = $('.deliverPwd_1').val();
		if(!/^[0-9]{6}$/.test(pwd_0)) {
			if(pwd_0 != pwd_1) {
				$('.deliverPwd_1').parent().siblings().css('visibility','visible');
			} else {
				$('.deliverPwd_0').parent().siblings().css('visibility','visible');
			}
			return;
		} else {
			$('.deliverPwd_1').parent().siblings().css('visibility','hidden');
			$('.deliverPwd_0').parent().siblings().css('visibility','hidden');
		}
		var deliverID = $('.deliverID').val();
		if(!/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(deliverID)) {
			$('.deliverID').parent().siblings().css('visibility','visible');
			return;
		} else {
			$('.deliverID').parent().siblings().css('visibility','hidden');
		}
		var deliverCompany = $('.deliverCompany').val();
		if(!/[\w\u4e00-\u9fa5]/.test(deliverCompany)) {
			$('.deliverCompany').parent().siblings().css('visibility','visible');
			return;
		} else {
			$('.deliverCompany').parent().siblings().css('visibility','hidden');
		}
		var deliverAddr = $('.deliverAddr').val();
		if(!/[\w\u4e00-\u9fa5]/.test(deliverAddr)) {
			$('.deliverAddr').parent().siblings().css('visibility','visible');
			return;
		} else {
			$('.deliverAddr').parent().siblings().css('visibility','hidden');
		}
		var deviceID = $('.deviceID').val();
		if(!/[\w\u4e00-\u9fa5]/.test(deviceID)) {
			$('.deviceID').parent().siblings().css('visibility','visible');
			return;
		} else {
			$('.deviceID').parent().siblings().css('visibility','hidden');
		}
		var checkCode = $('.checkCode').val();
		if(!/^[0-9]{6}$/.test(checkCode)) {
			$('.checkCode').parent().siblings().css('visibility','visible');
			return;
		} else {
			$('.checkCode').parent().siblings().css('visibility','hidden');
		}
		var location = $('.location').val();
		var group = $('.group option:selected').attr('id');
		alert(group);
		var data = {'deliverName':deliverName,
					'deliverTel':deliverTel,
					'deliverPwd':pwd_0,
					'deliverID':deliverID,
					'deliverCompany':deliverCompany,
					'deliverAddr':deliverAddr,
					'deviceID':deviceID,
					'checkCode':checkCode,
					'location':location,
					'groupID':group};
		var url = "sign.do";
		$.post(url, data, function(result){
			alert(result.message);
			if(result.state == 0) {
				WeixinJSBridge.call('closeWindow');
			} 
		});
		
	}

	function get_phone_code(obj) {
		var tel = $('.deliverTel').val();
		if(!/^1[3|4|5|8][0-9]\d{8}$/.test(tel)) {
			$('.deliverTel').parent().siblings().css('visibility','visible');
			alert("请先输入手机号.");
			return;
		}
		var url = "regcode.do";
		var data = {'phone':tel};
		$.post(url, data, function(result) {
			if(result.state == 1) {
				alert(result.message);
				return;
			} 
		});
		var obj = $(obj);
		if(obj.attr("disabled") == "disabled") {
			return;
		}
		obj.attr("disabled","disabled");
		var time = 60;
		var set=setInterval(function(){
	    	obj.html(--time+"s秒后重新获取");
	    }, 1000);/*等待时间*/
		setTimeout(function(){
			obj.attr("disabled",false).html("重新获取验证码");
	   		clearInterval(set);
	    }, 60000);	
	}
		
	$('.form-control').change(function(){
		var val = $(this).val();
		var clazz = $(this).attr("class").split(' ')[1];
		var reg;		
		if(clazz == "deliverName") {
			reg = /^([\u4E00-\uFA29]|[\uE7C7-\uE7F3])*$/;
		} else if(clazz == "deliverTel") {
			reg = /^1[3|4|5|8][0-9]\d{8}$/;
		} else if(clazz == "deliverPwd_0" || clazz == "deliverPwd_1" || clazz == "checkCode"){
			reg = /^[0-9]{6}$/;
		} else if(clazz == "deliverID") {
			reg = /(^\d{15}$)|(^\d{17}([0-9]|X)$)/;
		} else {
			reg = /[\w\u4e00-\u9fa5]/;
		} 			
		if(!reg.test(val)) {			
			$(this).parent().siblings().css('visibility','visible');
		} else {
			$(this).parent().siblings().css('visibility','hidden');
		}
	});
		   		
	AMap.plugin('AMap.Geolocation', function() {
		geolocation = new AMap.Geolocation({
			enableHighAccuracy: true,//是否使用高精度定位，默认:true
			timeout: 10000,          //超过10秒后停止定位，默认：无穷大
			buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
			zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
			buttonPosition:'RB'
		});		        
		geolocation.getCurrentPosition();
		AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
		AMap.event.addListener(geolocation, 'error', onError);      //返回定位出错信息
	});
	
    //解析定位结果
    function onComplete(data) {       
        //str.push('经度：' + data.position.getLng());
       // str.push('纬度：' + data.position.getLat());
		lnglatXY = [data.position.getLng(), data.position.getLat()]; //已知点坐标
		var geocoder = new AMap.Geocoder({
			radius: 1000,
			extensions: "all"
		});		
		geocoder.getAddress(lnglatXY, function(status, result) {			
			if (status === 'complete' && result.info === 'OK') {
				var address = result.regeocode.formattedAddress; //返回地址描述
				$(".location").val(address);
				//alert(address);
			}
		});     
    }
    //解析定位错误信息
    function onError(data) {
        alert('定位失败');
    }	
   
   
</script>

</body>
</html>